# 1. 简介

## 1.1 从 Hello World 开始

```c++
#include <stdio.h>

int main() {
    printf("Hello World!\n");
    return 0;
}
```

- 程序为什么要被编译器编译了之后才可以运行呢？
- 编译器在把 C 语言程序转换成可以执行的机器码的过程中做了什么，怎么做的？
- 最后编译出来的可执行文件里面是什么？除了机器码还有什么？它们怎么存放的，怎么组织的？
- #include <stdio.h> 是什么意思？把其包含进来意味着什么？C 语言库又是什么？它怎么实现的？
- 不同的编译器（Microsoft VC、GCC）和不同的硬件平台（X86、SPARC、MIPS、ARM），以及不同的操作系统（Windows、Linux、Unix、Solaris），最终编译出来的结果一样吗？为什么？
- Hello World 程序是怎么运行起来的？操作系统是怎么装载它的？它是从哪儿开始执行，到哪儿结束？main 函数之前发生了什么？main 函数结束以后又发生了什么？
- 如果没有操作系统，Hello World 可以运行吗？如果要在一台没有操作系统的机器上运行 Hello World 需要什么？应该怎么实现？
- printf 是怎么实现的？它为什么可以有不定数量的参数？为什么它能够在终端上输出字符串？
- Hello World 程序在运行时，它在内存中是什么样子的？

## 1.2 万变不离其宗

计算机的核心部件：中央处理器CPU、内存和I/O控制芯片。

早期的计算机没有很复杂的图形功能，CPU 的核心频率也不高，跟内存的频率一样，它们都是之间连接在同一个**总线**（**Bus**）上的。由于 I/O 设备诸如显示设备、键盘、软盘和磁盘等速度与 CPU 相比还是慢很多，当时也没有复杂的图像设备，显示设备大多是只能输出字符的终端。为了协调I/O设备和与总线之间的速度，也为了能够让 CPU 能够和 I/O 设备进行通信，一般每个设备都会有一个相应的I/O控制器。

![alt text](<./figs/Screenshot from 2024-09-22 22-38-53.png> "早期计算机")

后来由于 CPU 核心频率的提升，导致内存跟不上 CPU 的速度，于是产生了与内存频率一致的系统总线，而 CPU 采用倍频的方式与系统总线进行通信。接着随着图像化的操作系统普及，特别是 3D 游戏和多媒体的发展，是的图形芯片需要跟 CPU 和内存之间大量交换数据，慢速的 I/O 总线已经无法满足图形设备的巨大需求。为了协调 CPU、内存和高速的图像设备，人们专门设计了一个高速的北桥芯片，以便它们之间能够高速地交换数据。

由于北桥运行的速度非常高，所有相对低速的设备如果全部直接连接在北桥上，北桥既需处理高速设备，又须处理低速设备，设计就会十分复杂。于是人们又设计了专门处理低速设备的**南桥**（**South Bridge**）芯片，磁盘、USB、键盘、鼠标等设备都连接在南桥上，由南桥将它们汇总后连接到北桥上。20 世纪 90 年代的 PC 机在系统总线上采用的是 PCI 结构，而在低速设备上采用的 ISA 总线，采用 PCI/ISA 及南北桥设计的硬件架构如下图所示。

![alt text](<./figs/Screenshot from 2024-09-22 22-53-39.png> "PC 机硬件架构")

位于中间是连接所有高速芯片的**北桥**（**North Bridge, PCI Bridge**），它就像人的心脏，连接并驱动身体的各个部位；它的左边是 CPU，负责所有的控制和运算，就像人的大脑。北桥还还连接这几个高速部件，包括左边的内存和下面的 PCI 总线。

PCI 的速度最高为 133 MHz，它还是不能满足人们的需求，于是人们又发明了 AGP、PCI Express 等高速总线，它们的速度都超过 133 MHz，但仍然不能满足人们的需求。于是又发明了 PCI-X、PCI-E 等扩展总线，它们的速度更快，但仍然不能满足人们的需求。于是又发明了 PCI-E 4.0 标准，它将 PCI-E 总线的宽度扩展到了 128 位，可以同时连接 8 个设备，这样就可以满足人们对高速设备的需求。

### SMP与多核

人们总是希望计算机越来越快。在过去的 50 年里，CPU 的频率从 几十 KHz 到现在的 4 GHz，整整提高了数十万倍，基本上每 18 个月频率就会翻倍。但是自 2004 年以来，这种规律似乎已经失效，CPU 的频率自从那时开始再也没有发生质的提高。原因是人们在制造 CPU 的工艺方面已经达到了物理极限，除非 CPU 制造工艺有本质的突破，否则 CPU 的频率将会一直被目前 4 GHz 的“天花板”所限制。

在频率上短期内已经没有提高的余地，于是人们开始想办法从另一个角度来提高 CPU 的速度，就是增加 CPU 的数量。一个计算机拥有多个 CPU 早就不是什么新鲜事了，很早以前就有了多 CPU 的计算机，其中最常见的一种形式就是**对称多处理器**（**Symmetric Multi-Processing, SMP**），简单地讲就是每个 CPU 在系统中所处的地位和所发挥的功能都是一样的，都是相互对称的。理论上讲，增加 CPU 的数量就可以提高运算速度，并且理想情况下，速度的提高与 CPU 的数量成正比。但实际上并非如此，因为我们的程序并不是都能分解成若干个完全不相干的子问题。
